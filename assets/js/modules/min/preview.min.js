define(["backbone","notifications"],function(e,i){var t=e.Model.extend({idAttribute:"line_number"}),n=e.View.extend({template:_.template($("#template-preview-line").html()),render:function(){return this.template(this.model.attributes)}}),s=e.Collection.extend({model:t,url:function(){var e=_s["SYS_CFG.site_uri"]+"task/"+_s["PREVIEW.task_id"];return e+="/set/"+_s["PREVIEW.set_id"]+"/file/"+_s["PREVIEW.file_id"]+"/line/"}}),l=e.View.extend({el:".page",events:{"click .load-lines":"loadLines"},initialize:function(){this.collection=new s,this.listenTo(this.collection,"sync",this.render),this._load(1,100)},_load:function(e,i){this.collection.fetch({data:{start:e,end:i,preview:1,force_array:1},context:this,merge:!1,remove:!1,error:function(e){e.size()||(this.$(".no-lines").removeClass("hidden"),this.$(".row").remove())},complete:function(){this.$(".loading-lines").addClass("hidden")}})},loadLines:function(e){e&&e.preventDefault(),this._load(this.collection.size()+1,this.collection.size()+100)},render:function(e,i){i.length>=1&&this.$(".load-lines").removeClass("hidden"),e.size()===+_s["PREVIEW.lines"]&&this.$(".load-lines").addClass("hidden"),e.each(function(e){this.$(".row[data-row-id="+e.id+"]").length||this.$(".rows").append(new n({model:e}).render())},this)}});$(function(){new l})});